##
#set( $table = $entity )
#set( $prefix = "{{entity['" )
#set( $suffix = "']}}" )
##
<ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/home">Home</a></li>
    <li class="breadcrumb-item active"><a href="/${entity.name.toLowerCase()}">$entity.name</a></li>
    <li class="breadcrumb-item active">{{form}} $entity.name</li>
</ol>


<div class="container">
    <h2></h2>
    <div class="container">
        <form class="form-horizontal" method="post" id="${entity.name.toLowerCase()}_form">
            <div class="panel-group">
                <div class="panel panel-info">

                    <!-- ---------- BUTTONS [List] and [+] -->
                    <div class="panel-heading">
						<h3>
							<span class="glyphicon glyphicon-leaf"></span>
							{{form}} $entity.name
                            %if form == "Update" :
                            <a href="/${entity.name.toLowerCase()}/form">
                                <button type="button" formaction="/${entity.name.toLowerCase()}/form" class="btn btn-default pull-right">
                                    <span class="glyphicon glyphicon-plus"></span>
                                </button>
                            </a>
                            % end
                            <a href="/${entity.name.toLowerCase()}">
                                <button type="button" formaction="/${entity.name.toLowerCase()}" class="btn btn-link pull-right">
                                    List
                                </button>
                            </a>
						</h3>
					</div>

					<!-- ---------- FIELDS -->
                    <div class="panel-body">
                        {{!message}}
## ---------------------------------------------------------------------------------
## MACRO "gen_field($field)"
## ---------------------------------------------------------------------------------
#macro( gen_label $field )
#set($label=$field.name)
#if( $field.isKeyElement() ) 
#set($label="<u>${field.name}</u>") ## Primary Key => Underlined label
#end
#if( $field.isNotNull() ) 
#set($label="${label} *")
#end
    <label for="${field.name}" class="col-sm-2">${label}</label>
#end ## end of macro
##
## ---------------------------------------------------------------------------------
## MACRO "gen_field($field)"
## ---------------------------------------------------------------------------------
#macro( gen_field $field )
##
#set($disabled="")
#if( $field.isAutoIncremented() ) 
#set($disabled="disabled")
#end
##
#set($required="")
#if( $field.isNotNull() ) 
#set($required="required")
#end
##
#set($type="")
#if( ! $field.isTemporalType() ) 
#set($type="type=${QUOT}$field.inputType${QUOT}")
#end
##
  <!-- FIELD "${field.name}" #if($field.isKeyElement()) [PK] #end #if($field.isAutoIncremented()) AutoIncremented #end -->
  <div class="form-group">
#gen_label($field)
    <div class="col-sm-8">
    % if form == "Create" :
      <input id="${field.name}" class="form-control" name='$field.name' value="" $type placeholder="$field.neutralType" $required $disabled/>
    % elif form == "Update" : 
#if( $field.isKeyElement() )
    <h5> {{entity['${field.name}']}} </h5>
    <input type="hidden" name="${field.name}" value="{{entity['${field.name}']}}">
#else
    <input id="${field.name}" class="form-control" name='${field.name}' value="{{entity['${field.name}']}}" $type placeholder="$field.neutralType" $required $disabled />
#end
    % end
    </div>
  </div>
#end
## ---------------------------------------------------------------------------------
## MACRO "gen_combo_box($field)"
## ---------------------------------------------------------------------------------
#macro( gen_combo_box $field )
#set( $referencedEntityName = $fn.toLowerCase($field.referencedEntityName) )
#set( $comboLinkId = "${field.name}Link" )
  <!-- COMBO-BOX "${field.name}" #if($field.isKeyElement()) [PK] #end  -->
  <div class="form-group">
#gen_label($field)
    <div class="col-sm-8">
      % currentValue = ""
      <select id='$field.name' name='$field.name' class="selectpicker" >
      % for item in list_${referencedEntityName} :
        <option value="{{item['value']}}" 
        % if item['selected'] == True:
        selected="selected"
        % currentValue = item['value']
        % end
      >{{item['label']}}</option>
      % end
      </select>
      <!-- Button with link to referenced entity -->
##      <a id="${comboLinkId}" href="/${referencedEntityName}/form/{{currentValue}}" >
##        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-new-window"></span></button>
##      </a>
      <button type="button" class="btn btn-default" onclick="gotoPage('${field.name}', '${referencedEntityName}')" ><span class="glyphicon glyphicon-new-window"></span></button>
    </div>
  </div>
#end
## ---------------------------------------------------------------------------------
## --- KEY FIELD(S)
## ---------------------------------------------------------------------------------
#foreach( $field in $entity.keyAttributes )
#if( $field.isFK() ) 
#gen_combo_box($field) ## --- FK => COMBO BOX
#else
#gen_field( $field ) ## --- NOT FK => STANDARD FIELD
#end 

#end ## foreach
## ---------------------------------------------------------------------------------
## --- NON KEY FIELD(S)
## ---------------------------------------------------------------------------------
#foreach( $field in $entity.nonKeyAttributes )
#if( $field.isFK() ) 
#gen_combo_box($field) ## --- FK => COMBO BOX
#else 
#gen_field( $field ) ## --- NOT FK => STANDARD FIELD
#end

#end ## foreach
## ---------------------------------------------------------------------------------
#set( $entity = $table )
                    <!-- ---------- BUTTONS [Save] and [Delete] -->
                    </div>
                    % if form == "Create" :
                    <div class="panel-footer text-center">
                        <button type="submit" formmethod="post" formaction="/${entity.name.toLowerCase()}/create" name="non_fk" class="btn btn-success"><span class="glyphicon glyphicon-floppy-disk"></span> Save</button>
                        <div class="clearfix"></div>
                    </div>
                    % elif form == "Update" : 
                    <div class="panel-footer">
                        <button type="submit" formmethod="post" formaction="/${entity.name.toLowerCase()}/delete/$entity.keyAttributesNamesAsString('/', $prefix, $suffix)"  class="btn btn-danger pull-right"><span class="glyphicon glyphicon-trash"></span> Delete</button>
                        <button type="submit" formmethod="post" formaction="/${entity.name.toLowerCase()}/update"  class="btn btn-success"><span class="glyphicon glyphicon-floppy-disk"></span> Save</button>
                        <div class="clearfix"></div>
                    </div>
                    % end
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function gotoPage(comboId, entityName ) {
  var element = document.getElementById(comboId);
  if ( element != null ) {
	window.location.href = '/' + entityName + '/form/' + element.value ;
  }
  else {
  	alert("ERROR : Element '" + comboId + "' not found!");
  }
}

#foreach( $field in $entity.attributes )
#if( $field.isDateType() )
$(document).ready(function() {
    $(function () {
        $('${SHARP}${field.name}').datepicker({
            format: 'yyyy-mm-dd'
        });
    });
});
#end
#end
</script>